<!DOCTYPE html>
<html>
<head>
  <title>OneMap: Original Map (XYZ)</title>
  <link rel="stylesheet" href="https://www.onemap.gov.sg/web-assets/libs/leaflet/leaflet.css" />
  <script src="https://www.onemap.gov.sg/web-assets/libs/leaflet/onemap-leaflet.js"></script>
  <style>
    #mapdiv { height: 800px; width: 100%; }
  </style>
</head>
<body>
  <h1>Original Map (XYZ)</h1>
  <div id='mapdiv'></div>
  <script>
    const sw = L.latLng(1.144, 103.535);
    const ne = L.latLng(1.494, 104.502);
    const bounds = L.latLngBounds(sw, ne);

    const map = L.map('mapdiv', {
      center: L.latLng(1.3521, 103.8198),
      zoom: 12,
      maxBounds: bounds
    });

    const basemap = L.tileLayer('https://www.onemap.gov.sg/maps/tiles/Original/{z}/{x}/{y}.png', {
      detectRetina: true,
      maxZoom: 19,
      minZoom: 11,
      attribution: '<img src="https://www.onemap.gov.sg/web-assets/images/logo/om_logo.png" style="height:20px;width:20px;"/>&nbsp;<a href="https://www.onemap.gov.sg/" target="_blank">OneMap</a>&nbsp;&copy;&nbsp;contributors&nbsp;&#124;&nbsp;<a href="https://www.sla.gov.sg/" target="_blank">SLA</a>'
    });

    basemap.addTo(map);

    // Fetch from published Google Sheet
    fetch("https://docs.google.com/spreadsheets/d/e/2PACX-1vRkEkPfP_J2kJNPu6hFRhe_qaRJ2EGIHMm1ILWXqXxbGpx9hRHOeATDtX_-VngJcbHk6bvl_J_b6AzZ/pub?output=csv")
      .then(response => response.text())
      .then(data => {
        const rows = data.split("\n").slice(1);
        rows.forEach(row => {
          const cols = row.split(",");
          const lat = parseFloat(cols[10]);     // Adjust as needed
          const lng = parseFloat(cols[11]);
          const address = cols[6];
          const crime = cols[4] || "Unknown";

          if (!isNaN(lat) && !isNaN(lng)) {
            L.marker([lat, lng])
              .addTo(map)
              .bindPopup(`<b>${address}</b><br>Crime: ${crime}`);
          }
        });
      })
      .catch(error => {
        console.error("Error loading CSV:", error);
      });
  </script>
</body>
</html>
